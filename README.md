# ğŸ“± CaptureCat - ë‚˜ë§Œì˜ ìŠ¤í¬ë¦°ìƒ· ì¡°ë ¥ì
## ğŸš€ ì„œë¹„ìŠ¤ ì†Œê°œ
â€œì˜¤ëŠ˜ì€ ì–´ë–¤ ì •ë³´ë¥¼ ìº¡ì²˜í•˜ì…¨ë‚˜ìš”?â€

ìš°ë¦¬ëŠ” í•˜ë£¨ì—ë„ ìˆ˜ë§ì€ ì •ë³´ë¥¼ ìº¡ì²˜í•˜ì§€ë§Œ, ê°¤ëŸ¬ë¦¬ ì†ì—ì„œ ê¸ˆì„¸ ìŠíˆê³¤ í•©ë‹ˆë‹¤.
ìº¡ì²˜ìº£ì€ ìŠ¤í¬ë¦°ìƒ·ì„ ë‹¨ìˆœí•œ ì´ë¯¸ì§€ê°€ ì•„ë‹Œ, ë‹¤ì‹œ í™œìš© ê°€ëŠ¥í•œ ì •ë³´ë¡œ ë°”ê¿”ì£¼ëŠ” ì¡°ë ¥ìì…ë‹ˆë‹¤.

ì´ëŸ° ë¶„ê»˜ ì¶”ì²œí•´ìš”
- ê°¤ëŸ¬ë¦¬ì— ë‹¤ì–‘í•œ ì •ë³´ê°€ ìˆì§€ë§Œ ì •ë¦¬í•˜ê¸° ë§‰ë§‰í•œ ë¶„
- ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³´ê³  ì‹¶ì€ë° ì§€ìš°ê¸´ ì•„ê¹Œìš´ ë¶„
- í•„ìš”í•  ë•Œ ì°¾ì§€ ëª»í•´ ì‹œê°„ì„ ë‚­ë¹„í•œ ê²½í—˜ì´ ìˆëŠ” ë¶„

### ì£¼ìš” ê¸°ëŠ¥
- **ìŠ¤í¬ë¦°ìƒ· ìë™ ìˆ˜ì§‘**: Photos ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ìŠ¤í¬ë¦°ìƒ·ë§Œ ìë™ìœ¼ë¡œ í•„í„°ë§í•˜ì—¬ ìˆ˜ì§‘
- **íƒœê·¸ ê¸°ë°˜ ë¶„ë¥˜**: ìŠ¤í¬ë¦°ìƒ·ì— íƒœê·¸ë¥¼ ì¶”ê°€í•˜ì—¬ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì²´ê³„ì  ê´€ë¦¬
- **ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥**: ì¤‘ìš”í•œ ìŠ¤í¬ë¦°ìƒ·ì„ ì¦ê²¨ì°¾ê¸°ë¡œ í‘œì‹œí•˜ì—¬ ë¹ ë¥¸ ì ‘ê·¼
- **ê²€ìƒ‰ ê¸°ëŠ¥**: íƒœê·¸ ê¸°ë°˜ ê²€ìƒ‰ìœ¼ë¡œ ì›í•˜ëŠ” ìŠ¤í¬ë¦°ìƒ·ì„ ë¹ ë¥´ê²Œ íƒìƒ‰
- **ì„ì‹œë³´ê´€í•¨**: ì •ë¦¬ ì „ ìŠ¤í¬ë¦°ìƒ·ë“¤ì„ ì„ì‹œë¡œ ë³´ê´€í•˜ëŠ” ê³µê°„
- **ì†Œì…œ ë¡œê·¸ì¸**: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì„ í†µí•œ ê°„í¸í•œ íšŒì›ê°€ì… ë° ë™ê¸°í™”
- **ì„œë²„ ë™ê¸°í™”**: ë¡œê·¸ì¸ ì‹œ ìŠ¤í¬ë¦°ìƒ·ê³¼ íƒœê·¸ ì •ë³´ë¥¼ ì„œë²„ì™€ ë™ê¸°í™”

## ğŸ›  ì‚¬ìš© ê¸°ìˆ 

### í”„ë ˆì„ì›Œí¬ & ì–¸ì–´
- **Swift 5.0**
- **SwiftUI** - ëª¨ë˜í•œ UI í”„ë ˆì„ì›Œí¬
- **SwiftData** - ë¡œì»¬ ë°ì´í„° ê´€ë¦¬
- **Photos Framework** - ì‚¬ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ‘ê·¼
- **URLSession** - ë„¤íŠ¸ì›Œí¬ í†µì‹ 

### ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬
```
â€¢ KakaoSDKAuth, KakaoSDKCommon, KakaoSDKUser (2.24.5) - ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸
â€¢ Mixpanel (master branch) - ì‚¬ìš©ì í–‰ë™ ë¶„ì„
â€¢ SwiftLint (0.59.1) - ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬
â€¢ CryptoSwift (1.8.4) - ì•”í˜¸í™” ê¸°ëŠ¥
â€¢ CollectionConcurrencyKit (0.2.0) - ì»¬ë ‰ì…˜ ë™ì‹œì„± ì²˜ë¦¬
```

### ê°œë°œ í™˜ê²½
- **iOS Deployment Target**: 17.6+
- **Xcode**: ìµœì‹  ë²„ì „
- **ì•„í‚¤í…ì²˜**: Clean Architecture + MVVM

## ğŸ— í”„ë¡œì íŠ¸ êµ¬ì¡°

```
CaptureCat/
â”œâ”€â”€ App/                          # ì•± ì§„ì…ì  ë° ì„¤ì •
â”‚   â””â”€â”€ CaptureCatApp.swift
â”œâ”€â”€ Data/                         # ë°ì´í„° ë ˆì´ì–´
â”‚   â”œâ”€â”€ Network/                  # ë„¤íŠ¸ì›Œí¬ ê´€ë ¨
â”‚   â”‚   â”œâ”€â”€ Manager/              # NetworkManager, TokenManager
â”‚   â”‚   â”œâ”€â”€ Builder/              # API ë¹Œë” íŒ¨í„´
â”‚   â”‚   â”œâ”€â”€ Model/                # DTO ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ Serializer/           # ì§ë ¬í™”/ì—­ì§ë ¬í™”
â”‚   â”‚   â””â”€â”€ Storage/              # ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ (UserDefaults, Keychain)
â”‚   â””â”€â”€ Persistence/              # ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤
â”‚       â”œâ”€â”€ SwiftDataManager.swift
â”‚       â””â”€â”€ Screenshot.swift
â”œâ”€â”€ Domain/                       # ë„ë©”ì¸ ë ˆì´ì–´
â”‚   â”œâ”€â”€ Repositories/             # ë°ì´í„° ì €ì¥ì†Œ ì¶”ìƒí™”
â”‚   â””â”€â”€ Service/                  # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚       â”œâ”€â”€ AuthService.swift
â”‚       â”œâ”€â”€ ImageService.swift
â”‚       â”œâ”€â”€ TagService.swift
â”‚       â”œâ”€â”€ SyncService.swift
â”‚       â””â”€â”€ ScreenshotManager.swift
â”œâ”€â”€ Presentation/                 # í”„ë ˆì  í…Œì´ì…˜ ë ˆì´ì–´
â”‚   â”œâ”€â”€ Scenes/                   # í™”ë©´ë³„ View & ViewModel
â”‚   â”‚   â”œâ”€â”€ Auth/                 # ë¡œê·¸ì¸ ê´€ë ¨
â”‚   â”‚   â”œâ”€â”€ Home/                 # í™ˆ í™”ë©´
â”‚   â”‚   â”œâ”€â”€ Storage/              # ì„ì‹œë³´ê´€í•¨
â”‚   â”‚   â”œâ”€â”€ Search/               # ê²€ìƒ‰ í™”ë©´
â”‚   â”‚   â”œâ”€â”€ Tag/                  # íƒœê·¸ í¸ì§‘
â”‚   â”‚   â”œâ”€â”€ Detail/               # ìƒì„¸ í™”ë©´
â”‚   â”‚   â”œâ”€â”€ Favorite/             # ì¦ê²¨ì°¾ê¸°
â”‚   â”‚   â””â”€â”€ Navigation/           # ë„¤ë¹„ê²Œì´ì…˜ ë° íƒ­
â”‚   â””â”€â”€ ViewModels/               # ê³µìš© ViewModel
â”œâ”€â”€ DesignSystem/                 # ë””ìì¸ ì‹œìŠ¤í…œ
â”‚   â”œâ”€â”€ Component/                # ì¬ì‚¬ìš© UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ Color/                    # ì»¬ëŸ¬ ì‹œìŠ¤í…œ
â”‚   â””â”€â”€ Font/                     # í°íŠ¸ ì‹œìŠ¤í…œ
â””â”€â”€ Util/                         # ìœ í‹¸ë¦¬í‹°
    â”œâ”€â”€ PhotoLoader.swift         # ì´ë¯¸ì§€ ë¡œë”© & ìºì‹±
    â”œâ”€â”€ Extension/                # Swift í™•ì¥
    â””â”€â”€ KeyChain/                 # í‚¤ì²´ì¸ ê´€ë¦¬
```

## ğŸ› ì•„í‚¤í…ì²˜

### Clean Architecture + MVVM

```mermaid
graph TB
    subgraph "Presentation Layer"
        V[View] --> VM[ViewModel]
        VM --> V
    end
    
    subgraph "Domain Layer"
        VM --> R[Repository]
        VM --> S[Service]
        S --> R
    end
    
    subgraph "Data Layer"
        R --> NM[NetworkManager]
        R --> SDM[SwiftDataManager]
        R --> C[Cache]
    end
    
    subgraph "Infrastructure"
        NM --> API[REST API]
        SDM --> DB[SwiftData]
        C --> Memory[Memory Cache]
    end
```

### í•µì‹¬ íŒ¨í„´

#### 1. Repository Pattern
```swift
// ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë¡œì»¬/ì„œë²„ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ìë™ ë¶„ê¸°
func loadAll() throws -> [ScreenshotItemViewModel] {
    if AccountStorage.shared.isGuest ?? true {
        return try loadFromLocal()  // SwiftData ì‚¬ìš©
    } else {
        return InMemoryScreenshotCache.shared.retrieveAll()  // ë©”ëª¨ë¦¬ ìºì‹œ ì‚¬ìš©
    }
}
```

#### 2. Builder Pattern (Network)
```swift
protocol BuilderProtocol {
    associatedtype Response: Codable
    var path: String { get }
    var method: HTTPMethod { get }
    var headers: [String: String] { get }
    var parameters: [String: Any] { get }
}
```

#### 3. Actor Pattern (ë™ì‹œì„± ì œì–´)
```swift
actor TokenManager {
    private var currentRefreshTask: Task<Bool, Never>?
    
    func ensureValidToken() async -> Bool {
        // ë™ì‹œ í† í° ê°±ì‹  ë°©ì§€
    }
}
```

## ğŸ”¥ í•µì‹¬ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ë©”ëª¨ë¦¬ ê´€ë¦¬ ìµœì í™”

**ë¬¸ì œ**: ëŒ€ìš©ëŸ‰ ìŠ¤í¬ë¦°ìƒ· ë¡œë”© ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê¸‰ì¦

**í•´ê²°ì±…**:
```swift
// PhotoLoader.swift - ê³„ì¸µì  ìºì‹± ì „ëµ
private let cache = NSCache<NSString, UIImage>()  // ë©”ëª¨ë¦¬ ìºì‹œ
private let urlCache: URLCache                    // ë””ìŠ¤í¬ ìºì‹œ

// ë©”ëª¨ë¦¬ ì œí•œ ì„¤ì •
cache.totalCostLimit = 200 * 1024 * 1024  // 200MB
cache.countLimit = 500  // ìµœëŒ€ 500ê°œ

// ì•± ë¼ì´í”„ì‚¬ì´í´ ê¸°ë°˜ ìºì‹œ ê´€ë¦¬
private func handleMemoryWarning() {
    PhotoLoader.shared.clearAllLocalImageCache()  // ë©”ëª¨ë¦¬ ìºì‹œë§Œ ì •ë¦¬
    // ë””ìŠ¤í¬ ìºì‹œëŠ” ìœ ì§€í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ ë³´ì¡´
}
```

### 2. ë™ì‹œì„± ì œì–´ ë° í† í° ê°±ì‹ 

**ë¬¸ì œ**: ì—¬ëŸ¬ API í˜¸ì¶œ ì‹œ ë™ì‹œ í† í° ê°±ì‹ ìœ¼ë¡œ ì¸í•œ ì¶©ëŒ

**í•´ê²°ì±…**:
```swift
// TokenManager.swift - Actor íŒ¨í„´ìœ¼ë¡œ ë™ì‹œì„± ì œì–´
actor TokenManager {
    private var currentRefreshTask: Task<Bool, Never>?
    
    func ensureValidToken() async -> Bool {
        // ì§„í–‰ ì¤‘ì¸ ê°±ì‹ ì´ ìˆìœ¼ë©´ ê·¸ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¼
        if let ongoingTask = currentRefreshTask {
            return await ongoingTask.value
        }
        
        // ìƒˆë¡œìš´ ê°±ì‹  ì‘ì—… ì‹œì‘ (ë‹¨ì¼ ì‹¤í–‰ ë³´ì¥)
        let refreshTask = Task<Bool, Never> {
            await performTokenRefresh()
        }
        currentRefreshTask = refreshTask
        
        let result = await refreshTask.value
        currentRefreshTask = nil
        return result
    }
}
```

### 3. ë°°ì¹˜ ì—…ë¡œë“œ ì„±ëŠ¥ ìµœì í™”

**ë¬¸ì œ**: ëŒ€ëŸ‰ ìŠ¤í¬ë¦°ìƒ· ì—…ë¡œë“œ ì‹œ ì„œë²„ ë¶€í•˜ ë° íƒ€ì„ì•„ì›ƒ

**í•´ê²°ì±…**:
```swift
// SyncService.swift - ë°°ì¹˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§
private let batchSize = 5        // ë°°ì¹˜ í¬ê¸° ì œí•œ
private let maxRetries = 3       // ì¬ì‹œë„ íšŸìˆ˜

func syncLocalScreenshotsToServer() async -> SyncResult {
    let batches = screenshots.chunked(into: batchSize)
    
    for (batchIndex, batch) in batches.enumerated() {
        let result = await processBatch(batch)
        
        // ë°°ì¹˜ ê°„ ëŒ€ê¸°ë¡œ ì„œë²„ ë¶€í•˜ ë°©ì§€
        try? await Task.sleep(nanoseconds: 500_000_000)  // 0.5ì´ˆ
    }
}

// ê°œë³„ ë°°ì¹˜ ì²˜ë¦¬ ì‹œ ì¬ì‹œë„ ë¡œì§
private func processBatch(_ screenshots: [Screenshot]) async -> BatchResult {
    for attempt in 1...maxRetries {
        do {
            return try await uploadBatch(screenshots)
        } catch {
            if attempt == maxRetries { throw error }
            // ì§€ìˆ˜ ë°±ì˜¤í”„ë¡œ ì¬ì‹œë„ ê°„ê²© ì¦ê°€
            try? await Task.sleep(nanoseconds: UInt64(pow(2.0, Double(attempt)) * 1_000_000_000))
        }
    }
}
```

## ğŸ” ì£¼ìš” íŠ¹ì§•

- **ì´ì¤‘ ë°ì´í„° ì†ŒìŠ¤**: ê²ŒìŠ¤íŠ¸ ëª¨ë“œ(SwiftData) / ë¡œê·¸ì¸ ëª¨ë“œ(ì„œë²„ + ë©”ëª¨ë¦¬ ìºì‹œ)
- **í”„ë¦¬í˜ì¹­**: ì´ë¯¸ì§€ í”„ë¦¬ë¡œë”©ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ìµœì í™”
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: Scene Phase ê¸°ë°˜ ìë™ ìºì‹œ ì •ë¦¬
- **ì—ëŸ¬ í•¸ë“¤ë§**: ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ë³„ ì„¸ë¶„í™”ëœ ì²˜ë¦¬
- **ì‚¬ìš©ì ë¶„ì„**: Mixpanelì„ í†µí•œ ì‚¬ìš© íŒ¨í„´ ì¶”ì 

---

last updated version 1.0.1
